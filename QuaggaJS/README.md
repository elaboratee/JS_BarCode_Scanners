# Локализация штрих-кодов в библиотеке QuaggaJS
QuaggaJS - мощная библиотека для локализации и распознавания штрих-кодов. В данном документе содержится объяснение работы локализатора,
используемого в данной библиотеке.

## Как работает локализатор?
Основной функцией для локализации штрих-кодов является `locate` из файла `barcode_locator.js`.
Этапы работы данной функции приведены ниже:

1. Уменьшение масштаба изображения (опционально)
```js
if (_config.halfSample) {
    halfSample(_inputImageWrapper, _currentImageWrapper);
}
```
   - Если в конфигурации установлен флаг `halfSample`, изображение уменьшается в 2 раза по ширине и высоте
   - Уменьшение масштаба ускоряет обработку на этапе поиска патчей, особенно для больших изображений

2. Бинаризация изображения
```js
binarizeImage();
```
  - Преобразует изображение в бинарный формат при помощи пороговой обработки методом Оцу с одним порогом
  - Получается изображение, где светлые области (потенциальные полосы штрих-кода) выделены на темном фоне

3. Поиск патчей
```js
patchesFound = findPatches();
// return unless 5% or more patches are found
if (patchesFound.length < _numPatches.x * _numPatches.y * 0.05) {
    return null;
}
```
  - Функция `findPatches` разбивает изображение на сетку патчей и анализирует каждый из них на наличие контрастных полос, характерных для штрих-кодов
  - Если найдено менее 5% патчей (в зависимости от размеров сетки `_numPatches.x` и `_numPatches.y`), функция возвращает `null`, так как вероятность
  наличия штрих-кодов слишком мала
  - В результате получается массив патчей (координаты и характеристики), которые могут содержать штрих-коды

4. Растеризация угловой схожести
```js
// rasterrize area by comparing angular similarity;
var maxLabel = rasterizeAngularSimilarity(patchesFound);
if (maxLabel < 1) {
    return null;
}
```
  - Функция `rasterizeAngularSimilarity` группирует патчи на основе схожести их угловых направлений
  - Так как, одномерные штрих-коды представляют собой параллельные линии, патчи с одинаковыми угловыми характеристиками объединяются
  - Если не найдено ни одной группы патчей (`maxLabel < 1`), функция возвращает `null`

5. Поиск наибольших соединенных областей
```js
// search for area with the most patches (biggest connected area)
topLabels = findBiggestConnectedAreas(maxLabel);
if (topLabels.length === 0) {
    return null;
}
```
  - Функция `findBiggestConnectedAreas` определяет крупнейшие области, содержащие наибольшее количество патчей
  - Большие области с высокой плотностью патчей с большей вероятностью содержат штрих-коды
  - Функция отбирает только области, объединяющие 5 или более патчей. Если такие области не найдены, функция возвращает `null`

6. Определение bounding boxes
```js
boxes = findBoxes(topLabels, maxLabel);
return boxes;
```
  - Функция `findBoxes` рассчитывает координаты bounding boxes вокруг найденных областей
  - Возвращает массив объектов с координатами прямоугольников, которые предполагают наличие штрих-кодов

## Файлы и функции
Рассмотрим более подробно используемые при локализации функции из различных файлов библиотеки. Далее будут приведены описания функций, их входные и выходные значения, а также основные этапы их работы.
